---
layout: post
title: GDG Devfest Hyderabad 2017 - Building Google Assitant App
date: '2017-11-19T13:41:00.002+05:30'
author: Neil Ghosh
tags:
- DialogFlow
- Google Assistant
- Google Devfest
- Machine Learning
modified_time: '2017-11-19T14:09:01.399+05:30'
thumbnail: https://4.bp.blogspot.com/-mxkFw2xiJpo/WhE_nj_zVhI/AAAAAAACRNY/XlKOZerRBuYkaUOyw26iwI-Af_qmZTH7gCLcBGAs/s72-c/Screen%2BShot%2B2017-11-19%2Bat%2B1.53.26%2BPM.png
blogger_id: tag:blogger.com,1999:blog-6081677503074893817.post-3807066409597967578
blogger_orig_url: https://www.neilghosh.com/2017/11/gdg-devfest-hyderabad-2017-building.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">Growing up we read stories where we talk to robots and get our things done. There has been decent amount of advancement in robotics to help us in the manufacturing industry and space exploration.However, it is still not a thing that someone can own one easily and dictate with commands.&nbsp; Voice-based interaction and computing is a new and exciting area. With so much of investment in Amazon's Alexa, Google's Assistant, Apple's Siri and Microsoft's Cortana etc, it's definitely going to be a serious business in near future. Right now most of us are just having fun with knowledge based questions and puzzle/riddles. These platforms also allow us to create our own app and make it accessible to the whole world to interact with just user's voice.<br /><br />Lately, I have been trying out building such apps with Google Voice Actions and got a chance to demo the same at <a href="https://devfest.gdghyderabad.in/">GDG Devfest Hyderabad</a> this year. Here is <a href="https://docs.google.com/presentation/d/1jI5Z39A0iylQvdjCfgh0IyZiR_yeU1GxFLRIfkMKIjg/edit?usp=sharing" target="_blank">the slide</a>, however it was mostly a live demo.<br /><br />I tried to create a Google assistant app which will respond with the stock price of any company registered in NSE.<br /><h3 style="text-align: left;">Creating an Agent and Intent</h3><ol style="text-align: left;"><li>&nbsp;Head over to <a href="https://console.dialogflow.com/api-client/#/agents">DialogFlow.com</a> to create your own agent. Name it "Market-Guru". Note every agent is an app once integrated to Google Assitant.</li><li>In the <i>Intents</i> section, you can change the default and fallback intent to customize what should it respond when you enter the app (e.g "Welcome to Market Guru") and when it does not recognize any intent. (e.g "I can't tell that, you can try asking stock price of companies.")</li><li>&nbsp;Create a new Intent called "Stock-Teller". This is something that should be invoked when you ask the app a certain question.&nbsp;</li><li>You can enter this question and its varients in the "<span class="title">User says</span>" section of the intent.</li><li>In the "Text Response" section at the bottom, you can mention what it should answer when you ask the question.</li><li>Once you save the question, you will get a toaster saying "Agent training started". This is when dialogflow trains its model using the sample questions you provided for the intent and its own language knowledge.&nbsp;</li><li>You can test your agent right now by typing the questions in the top right section. e.g. "<span class="text"><span class="ng-binding" id="test-client-resolved-query">What is the price of Infosys limited?</span></span>" and you should get the hardcoded response that you have typed in earlier. However if you ask something like "How are you?" It does not really match with the questions in the intent "Stock-Teller" or any other intent defined, it will fall back to the<i> fallback intent</i> and respond with a generic answer that you may have hardcoded there.&nbsp;</li><li>You can also ask the variant of the question like "What is the <b>share</b> price of Infosys Limited" and it should be already smart enough to match with the intent "Stock-Teller" although this exact question is not mentioned.</li><li>Now you may want to recognize the company name that was spoken in the question. So you can click on the phrase "Infosys Limited" and create a parameter and name it company_name. The entity of the parameter should be @sys.any because it could be any text, right now we don't have an exhaustive list of company names.</li><li>You can change the response from hardcoded string to "I don't know $company_name price yet." and test again. It should be able to respond the recognized company name.</li><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-mxkFw2xiJpo/WhE_nj_zVhI/AAAAAAACRNY/XlKOZerRBuYkaUOyw26iwI-Af_qmZTH7gCLcBGAs/s1600/Screen%2BShot%2B2017-11-19%2Bat%2B1.53.26%2BPM.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="704" data-original-width="1542" height="288" src="https://4.bp.blogspot.com/-mxkFw2xiJpo/WhE_nj_zVhI/AAAAAAACRNY/XlKOZerRBuYkaUOyw26iwI-Af_qmZTH7gCLcBGAs/s640/Screen%2BShot%2B2017-11-19%2Bat%2B1.53.26%2BPM.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Extracting keywords/parameters from questions.</td></tr></tbody></table><li>Try adding more varients of questions and tag the company name for better accurancy. like "How&nbsp;much&nbsp;does&nbsp;<span class="selection" style="background-color: #fffda6;">Infosys</span>&nbsp;cost?"</li></ol><h3 style="text-align: left;"><span class="title">Fulfillment</span> </h3><div style="text-align: left;">So far we have just hardcoded the response. To dynamically fetch the required data from any web service you can make it talk to a web service.</div><ol style="text-align: left;"><li>Since dialogflow calls web service and expects the response in a specific format you have to create an endpoint to plug.</li><li>You can create a cloud function at <a href="https://console.cloud.google.com/functions/">Google Cloud Platform Console</a> and use the following Node.js code to return the stock price given the company name. This actually calls another web service to fetch the stock price and formats in a way that dialogflow can understand. <script src="https://gist.github.com/neilghosh/6931a8ed3d3e7d5eaec2769712596bc2.js"></script></li><li>In <span class="title">Fulfillment</span> section add the generated endpoint URL.</li><li>After saving, you should go to the intent "Stock-Teller" and check the box at the bottom which says "Use webhook" under <span class="title">Fulfillment section. This will make it call the webhook URL instead of responding with the hardcoded reponse.</span></li><li><span class="title">Now you can test again and if the URL call is sucessful, it should return the stock price and you can try the play button again the reponse to read it loud also. If the URL call failed, it would fall back to the default hardcoded reponse.&nbsp;&nbsp;</span></li><li><span class="title">If something goes wrong, check the JSON request/response from the bottom right side and verify if correct parameters are sent or the webhook response code is HTTP 200 or not. If the webhook execution fails, then you may want to check the cloud function log to see any problems in Node.js code.&nbsp;</span></li></ol><span class="title"></span><span class="title"></span><br /><h3><span class="title">Integration</span></h3><span class="title">Finally we want to make it available in Google Assitant.</span><br /><ol><li><span class="title">In the integrations tab enable "Google Assitant" so that it would call dialogflow API (Google Assitant would convert speech to text and send a query to dialogflow with question in text format.) to answer your questions. Note, in this screen you have a lot more options like Skype and Slack to create a chatbot, however we need a voice conversation.&nbsp;&nbsp;</span></li><li><span class="title">Once you click the Google Assitant integration, you can click on the "Test" to make your app available for simulation and then click "View" to head over to the <a href="https://console.actions.google.com/">Google Voice Actions simulator.</a></span> You can also select the agent that you have created at the top.<span class="title"><a href="https://console.actions.google.com/"><br /></a></span><span class="title"></span></li><li><span class="title">In the simulator you can just type or speaki using the mic button to say "Talk to my test app" and it should pull up your recently created agent from dialogflow.</span></li><li><span class="title">First it would greet you with the response mentioned in "Default response"</span></li><li><span class="title">Since your app is up for simulation already, now you can try this from any of your device live phone's Google Assitant , Google Home or Raspberry Pi which is signed in with the same Google accout that you created your test app.</span></li><li><span class="title">&nbsp;You can also just import the while agent which I <a href="https://github.com/neilghosh/devfesthyd2017/raw/master/Market-Guru.zip">have exported</a> to setup everything at once, instead of creating from scratch in the console. You may have to adjust the webhook URL to make sure it point to the current one. I may take down the demo cloud function to avoid cost.<br /><a href="https://github.com/neilghosh/devfesthyd2017/raw/master/Market-Guru.zip">https://github.com/neilghosh/devfesthyd2017/raw/master/Market-Guru.zip</a></span></li><li><span class="title">All the things that you do within the dialogflow console can also be programetically done using dialogflow APIs. </span></li></ol><h3 style="text-align: left;">Training&nbsp;</h3><div style="text-align: left;">If at any time during testing the intents ad parameters are not recognized properly then&nbsp; you can head over to the training tab and correct the behaviour for any bad executions in the history. This will re-train the machine learning model helping with future convesations.</div><h3 style="text-align: left;">Other Possibilities.</h3><div style="text-align: left;">Here are some more stuff you can do to make your UX better.</div><ol style="text-align: left;"><li>Make the parameters "Action" section of the intent mandatory to ask the user back if he gives incomplete information in the question.</li><li>You can create a follow up intent for any intent to make confirmation or get user choice before you execute what user says.&nbsp;</li><li>For follow up questions, you can use the parameters from the existing intent's context. i.e. #context_name.param_name would retrive any earlier parameters and user does not have to repeat the whole question all over again just because he missed out on a specific piece of information.</li><li>You can set output context and take decisions based in the intent name from within the webhook prgramatically.</li><li>You can optionally send rich output to your phone's Google Assitant which can include images, cards etc.</li></ol><h3><span class="title"></span></h3></div>